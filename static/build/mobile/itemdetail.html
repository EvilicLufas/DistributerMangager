<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,target-densitydpi=medium-dpi">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<script type="text/javascript" src="/fishstrap/lib/mod.js"></script>
	<title>商品详情页面</title>
<link rel="stylesheet" type="text/css" href="/mobile/common/core/core_8488e02.css">
<link rel="stylesheet" type="text/css" href="/mobile/common/dialog/dialog_09f6162.css">
<link rel="stylesheet" type="text/css" href="/mobile/common/header/header_b51a32c.css">
<link rel="stylesheet" type="text/css" href="/mobile/common/shopcart/shopcart_a6ea491.css">
<link rel="stylesheet" type="text/css" href="/mobile/common/numchooser/numchooser_c64b34c.css">
<link rel="stylesheet" type="text/css" href="/mobile/common/itembrief/itembrief_bc23208.css">
<link rel="stylesheet" type="text/css" href="/mobile/common/itemarticle/itemarticle_cf5c6d1.css">
<link rel="stylesheet" type="text/css" href="/mobile/common/footerbutton/footerbutton_eea48c6.css">
<link rel="stylesheet" type="text/css" href="/mobile/common/itemdialog/itemdialog_c3c938c.css">

<script type="text/javascript" src="/fishstrap/lib/fastclick.js"></script>
<script type="text/javascript" src="http://apps.bdimg.com/libs/underscore.js/1.7.0/underscore-min.js"></script>
<script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="/fishstrap/core/global_0ffe271.js"></script>
<script type="text/javascript" src="/mobile/common/dialog/dialog_e661e90.js"></script>
<script type="text/javascript" src="/mobile/common/core/core_ced14df.js"></script>
<script type="text/javascript" src="/mobile/common/header/header_23de960.js"></script>
<script type="text/javascript" src="/mobile/common/shopcart/shopcart_6e67c2f.js"></script>
<script type="text/javascript" src="/fishstrap/util/uedit_466b933.js"></script>
<script type="text/javascript" src="/mobile/common/numchooser/numchooser_faad02f.js"></script>
<script type="text/javascript" src="/mobile/common/itembrief/itembrief_6ce8ed8.js"></script>
<script type="text/javascript" src="/mobile/common/itemarticle/itemarticle_560048e.js"></script>
<script type="text/javascript" src="/mobile/common/footerbutton/footerbutton_7c867f1.js"></script>
<script type="text/javascript" src="/mobile/common/itemdialog/itemdialog_b336c91.js"></script>

</head>
<body>
	<div id="body"></div>
	<script type="text/javascript">
		var $ = require('mobile/common/core/core.js');
		var dialog = require('mobile/common/dialog/dialog.js');
		var Header = require('mobile/common/header/header.js');
		var ShopCart = require('mobile/common/shopcart/shopcart.js');
		var ItemArticle = require('mobile/common/itemarticle/itemarticle.js');
		var FooterButton = require('mobile/common/footerbutton/footerbutton.js');
		var ItemDialog = require('mobile/common/itemdialog/itemdialog.js');
		var commodity = {};
		var shopCommodityId = $.location.getQueryArgv('shopCommodityId');
		function getCommodity(next){
			$.get('/commodity/getDetail',{shopCommodityId:shopCommodityId},function(data){
				if( data.code != 0 ){
					dialog.message(data.msg);
					return;
				}
				commodity = data.data;
				next();
			});
		}
		function showDialog(name,next){
			var dialogArgv = {
				image:commodity.icon,
				title:commodity.title,
				summary:commodity.introduction,
				price:commodity.priceShow,
				oldprice:commodity.oldPriceShow,
				stock:commodity.inventory,
			};
			if(name=='buy'){
				dialogArgv = $.extend(dialogArgv,{confirmName:'buy',confirmText:'立即购买',confirmClick:next});
			}else{
				dialogArgv = $.extend(dialogArgv,{confirmName:'cart',confirmText:'加入购物车',confirmClick:next});
			}
			$.page.append(new ItemDialog(dialogArgv).el);
		}
		function showBuyDialog(){
			showDialog('buy',function(quantity){
				$.post('/troller/add',{shopCommodityId:shopCommodityId,quantity:quantity},function(data){
					if(data.code != 0 ){
						dialog.message(data.msg);
						return;
					}
					location.href = 'shopcart.html';
				});
			});
		}
		function showCartDialog(){
			showDialog('cart',function(quantity){
				$.post('/troller/add',{shopCommodityId:shopCommodityId,quantity:quantity},function(data){
					if(data.code != 0 ){
						dialog.message(data.msg);
						return;
					}
					dialog.message('成功添加商品到购物车');
				});
			});
		}
		function go(){
			var header = new Header({
				title:commodity.title,
				backLink:'item.html',
				button:[{
					name:'search',
					link:'search.html'
				}]
			});
			var shopcart = new ShopCart();
			var itemarticle = new ItemArticle({
				image:commodity.icon,
				title:commodity.title,
				summary:commodity.introduction,
				price:commodity.priceShow,
				oldprice:commodity.oldPriceShow,
				stock:commodity.inventory,
				content:commodity.detail,
			});
			var footerbutton = new FooterButton([
				{
					name:'buy',
					text:'立即购买',
					click:function(){
						showBuyDialog();
					}
				},
				{
					name:'cart',
					text:'加入购物车',
					click:function(){
						showCartDialog();
					}
				}
			]);
			var pageHtml = header.el + itemarticle.el + footerbutton.el + shopcart.el;
			$.page.start(pageHtml);
		}
		$.checkMustLogin(function(){
			getCommodity(go);
		});
	</script>
</body>
</html>